/*! angular-locker v1.3.8 | (c) 2015  | https://github.com/alejandroSuch/angular-locker/ */
!function(e,t){"function"==typeof define&&define.amd?define(function(){return t(e.angular)}):"object"==typeof exports?module.exports=t(e.angular||window&&window.angular):t(e.angular)}(this,function(e){"use strict";e.module("angular-locker",[]).provider("locker",function(){var t=function(t,r){return e.isFunction(t)?t(r):t},r=function(e,t){return Object.keys(e).filter(function(r){return e[r]===t})[0]},i=function(e){throw new Error("[angular-locker] "+e)},s={driver:"local",namespace:"locker",eventsEnabled:!0,separator:"."};return{setDefaultDriver:function(e){return s.driver=t(e),this},getDefaultDriver:function(){return s.driver},setDefaultNamespace:function(e){return s.namespace=t(e),this},getDefaultNamespace:function(){return s.namespace},setEventsEnabled:function(e){return s.eventsEnabled=t(e),this},getEventsEnabled:function(){return s.eventsEnabled},setSeparator:function(e){return s.separator=t(e),this},getSeparator:function(){return s.separator},$get:["$window","$rootScope","$parse",function(n,o,a){function h(a,h){this._registeredDrivers={local:n.localStorage,session:n.sessionStorage},this._resolveDriver=function(e){return this._registeredDrivers.hasOwnProperty(e)||i('The driver "'+e+'" was not found.'),this._registeredDrivers[e]},this._deriveDriver=function(e){return r(this._registeredDrivers,e)},this._driver=this._resolveDriver(a),this._namespace=h,this._eventsEnabled=s.eventsEnabled,this._separator=s.separator,this._watchers={},this._cryptoKey={value:null},this._checkSupport=function(t){if(e.isUndefined(this._supported)){var r="l";try{this._resolveDriver(t||"local").setItem(r,r),this._resolveDriver(t||"local").removeItem(r),this._supported=!0}catch(i){this._supported=!1}}return this._supported},this._getPrefix=function(e){return this._namespace?this._namespace+this._separator+e:e},this._serialize=function(t){try{return e.toJson(t)}catch(r){return t}},this._unserialize=function(t){try{return e.fromJson(t)}catch(r){return t}},this._event=function(t,r){this._eventsEnabled&&o.$emit(t,e.extend(r,{driver:this._deriveDriver(this._driver),namespace:this._namespace}))},this._setItem=function(t,r,s){this._checkSupport()||i("The browser does not support localStorage");try{var n=this._getItem(t),o=this._serialize(r),a=o;s&&window.sjcl&&this._cryptoKey.value&&a&&(a=window.sjcl.encrypt(this._cryptoKey.value,o,{mode:"ccm",ks:128},{})),this._driver.setItem(this._getPrefix(t),a),this._exists(t)&&!e.equals(n,a)?this._event("locker.item.updated",{key:t,oldValue:n,newValue:a}):this._event("locker.item.added",{key:t,value:r})}catch(h){-1!==["QUOTA_EXCEEDED_ERR","NS_ERROR_DOM_QUOTA_REACHED","QuotaExceededError"].indexOf(h.name)?i("The browser storage quota has been exceeded"):i('Could not add item with key "'+t+'"')}},this._getItem=function(e,t){this._checkSupport()||i("The browser does not support localStorage");var r=this._driver.getItem(this._getPrefix(e)),s=r;return t&&window.sjcl&&this._cryptoKey.value&&r&&(s=window.sjcl.decrypt(this._cryptoKey.value,r,{},{})),this._unserialize(s)},this._exists=function(e){return this._checkSupport()||i("The browser does not support localStorage"),this._driver.hasOwnProperty(this._getPrefix(t(e)))},this._removeItem=function(e){return this._checkSupport()||i("The browser does not support localStorage"),this._exists(e)?(this._driver.removeItem(this._getPrefix(e)),this._event("locker.item.forgotten",{key:e}),!0):!1}}return h.prototype={put:function(r,i,s){if(!r)return!1;if(r=t(r),e.isObject(r))e.forEach(r,function(e,t){this._setItem(t,e,!!s)},this);else{if(!e.isDefined(i))return!1;this._setItem(r,t(i,this._getItem(r,!!s)),!!s)}return this},add:function(e,t,r){return this.has(e)?!1:(this.put(e,t,r),!0)},get:function(t,r,i){if(e.isArray(t)){var s={};return e.forEach(t,function(e){this.has(e)&&(s[e]=this._getItem(e,!!i))},this),s}return this.has(t)?this._getItem(t,!!i):-1!==[2,3].indexOf(arguments.length)?r:void 0},has:function(e){return this._exists(e)},forget:function(r){return r=t(r),e.isArray(r)?r.map(this._removeItem,this):this._removeItem(r),this},pull:function(e,t,r){var i=this.get(e,t,!!r);return this.forget(e),i},all:function(){var t={};return e.forEach(this._driver,function(e,r){var i=r.split(this._separator);i.length>1&&i[0]===this._namespace&&(i.splice(0,1),r=i.join(this._separator)),this.has(r)&&(t[r]=this.get(r))},this),t},clean:function(){return this.forget(Object.keys(this.all())),this},empty:function(){return this._driver.clear(),this},count:function(){return Object.keys(this.all()).length},bind:function(t,r,i,s){var n=s||r,o=this,h=n+t.$id;if(this._watchers[h]=t.$watch(n,function(t){e.isDefined(t)&&o.put(r,t)},e.isObject(t[n])),e.isUndefined(t.$eval(n))){var u=this.get(r,i);a(n).assign(t,u)}return this},bindEncrypted:function(t,r,i,s){var n=s||r,o=this,h=n+t.$id;if(this._watchers[h]=t.$watch(n,function(t){e.isDefined(t)&&o.put(r,t,!0)},e.isObject(t[n])),e.isUndefined(t.$eval(n))){var u=this.get(r,i,!0);a(n).assign(t,u)}return this},unbind:function(e,t,r,i){var s=r||t;a(s).assign(e,null),i||this.forget(t);var n=s+e.$id;return this._watchers[n]&&(this._watchers[n](),delete this._watchers[n]),this},driver:function(e){return this.instance(e,this._namespace)},getDriver:function(){return this._driver},namespace:function(e){return this.instance(this._deriveDriver(this._driver),e)},getNamespace:function(){return this._namespace},supported:function(e){return this._checkSupport(e)},setCryptoKey:function(t){e.isString(t)&&0!==t.length&&0!==t.replace(/\s/gm,"").length&&(this._cryptoKey.value=t)},clearWatchers:function(){for(var e in this._watchers)this._watchers[e]()},instance:function(e,t){var r=new h(e,t);return r.setCryptoKey(this._cryptoKey.value),r}},new h(s.driver,s.namespace)}]}})});
//# sourceMappingURL=angular-locker.min.js.map