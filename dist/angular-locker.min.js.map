/*! angular-locker v1.3.6 | (c) 2015  | https://github.com/alejandroSuch/angular-locker/ */
{"version":3,"sources":["angular-locker.min.js"],"names":["root","factory","define","amd","angular","exports","module","window","this","provider","_value","value","param","isFunction","_keyByVal","object","Object","keys","filter","key","_error","msg","Error","defaults","driver","namespace","eventsEnabled","separator","setDefaultDriver","getDefaultDriver","setDefaultNamespace","getDefaultNamespace","setEventsEnabled","enabled","getEventsEnabled","setSeparator","getSeparator","$get","$window","$rootScope","$parse","Locker","_registeredDrivers","local","localStorage","session","sessionStorage","_resolveDriver","hasOwnProperty","_deriveDriver","_driver","_namespace","_eventsEnabled","_separator","_watchers","_cryptoKey","_checkSupport","isUndefined","_supported","l","setItem","removeItem","e","_getPrefix","_serialize","toJson","_unserialize","fromJson","_event","name","payload","$emit","extend","_setItem","encrypted","oldVal","_getItem","serializedValue","finalValue","sjcl","encrypt","mode","ks","_exists","equals","oldValue","newValue","indexOf","getItem","item","decrypt","_removeItem","prototype","put","isObject","forEach","isDefined","add","has","get","def","isArray","items","k","arguments","length","forget","map","pull","all","split","splice","join","clean","empty","clear","count","bind","$scope","attr","index","self","watcherId","$id","$watch","newVal","$eval","assign","bindEncrypted","unbind","dontForget","instance","getDriver","getNamespace","supported","setCryptoKey","isString","replace","locker"],"mappings":"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","file":"angular-locker.min.js","sourcesContent":["/**\n * angular-locker\n *\n * A simple & configurable abstraction for local/session storage in angular projects with SJCL crypto support\n *\n * @link https://github.com/alejandroSuch/angular-locker/\n * @author Sean Tymon @tymondesigns\n * @author Alejandro Such @alejandro_such\n * @license MIT License, http://www.opensource.org/licenses/MIT\n */\n\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define(function () {\n            return factory(root.angular);\n        });\n    } else if (typeof exports === 'object') {\n        module.exports = factory(root.angular || (window && window.angular));\n    } else {\n        factory(root.angular);\n    }\n})(this, function (angular) {\n\n    'use strict';\n\n    angular.module('angular-locker', [])\n\n    .provider('locker', function () {\n\n        /**\n         * If value is a function then execute, otherwise return\n         *\n         * @param  {Mixed}  value\n         * @param  {Mixed}  parameter\n         * @return {Mixed}\n         */\n        var _value = function (value, param) {\n            return angular.isFunction(value) ? value(param) : value;\n        };\n\n        /**\n         * Get the key of an object by the value\n         *\n         * @param  {Object}  object\n         * @param  {Mixed}   value\n         * @return {String}\n         */\n        var _keyByVal = function (object, value) {\n            return Object.keys(object).filter(function (key) { return object[key] === value; })[0];\n        };\n\n        /**\n         * Trigger an error\n         *\n         * @param  {String}  msg\n         * @return {void}\n         */\n        var _error = function (msg) {\n            throw new Error('[angular-locker] ' + msg);\n        };\n\n        /**\n         * Set the default driver and namespace\n         *\n         * @type {Object}\n         */\n        var defaults = {\n            driver: 'local',\n            namespace: 'locker',\n            eventsEnabled: true,\n            separator: '.'\n        };\n\n        var cryptoKey = null;\n\n        return {\n             /**\n             * Allow setting of default storage driver via `lockerProvider`\n             * e.g. lockerProvider.setDefaultDriver('session');\n             *\n             * @param {String}  driver\n             */\n            setDefaultDriver: function (driver) {\n                defaults.driver = _value(driver);\n\n                return this;\n            },\n\n            /**\n             * Get the default driver\n             */\n            getDefaultDriver: function () {\n                return defaults.driver;\n            },\n\n            /**\n             * Allow setting of default namespace via `lockerProvider`\n             * e.g. lockerProvider.setDefaultNamespace('myAppName');\n             *\n             * @param {String}  namespace\n             */\n            setDefaultNamespace: function (namespace) {\n                defaults.namespace = _value(namespace);\n\n                return this;\n            },\n\n            /**\n             * Get the default namespace\n             */\n            getDefaultNamespace: function () {\n                return defaults.namespace;\n            },\n\n            /**\n             * Set whether the events are enabled\n             *\n             * @param {Boolean}  enabled\n             */\n            setEventsEnabled: function (enabled) {\n                defaults.eventsEnabled = _value(enabled);\n\n                return this;\n            },\n\n            /**\n             * Get whether the events are enabled\n             */\n            getEventsEnabled: function () {\n                return defaults.eventsEnabled;\n            },\n\n            /**\n             * Set the separator to use with namespace in keys\n             *\n             * @param {String} separator\n             */\n            setSeparator: function (separator) {\n                defaults.separator = _value(separator);\n\n                return this;\n            },\n\n            /**\n             * Get the separator\n             */\n            getSeparator: function () {\n                return defaults.separator;\n            },\n\n            /**\n             * The locker service\n             */\n            $get: ['$window', '$rootScope', '$parse', function ($window, $rootScope, $parse) {\n\n                /**\n                 * Define the Locker class\n                 *\n                 * @param {Storage}  driver\n                 * @param {String}   namespace\n                 */\n                function Locker (driver, namespace) {\n\n                    /**\n                     * @type {Object}\n                     */\n                    this._registeredDrivers = {\n                        local: $window.localStorage,\n                        session: $window.sessionStorage\n                    };\n\n                    /**\n                     * Get the Storage instance from the key\n                     *\n                     * @param  {String}  driver\n                     * @return {Storage}\n                     */\n                    this._resolveDriver = function (driver) {\n                        if (! this._registeredDrivers.hasOwnProperty(driver)) {\n                            _error('The driver \"' + driver + '\" was not found.');\n                        }\n\n                        return this._registeredDrivers[driver];\n                    };\n\n                    /**\n                     * Get the driver key (local/session) by the Storage instance\n                     *\n                     * @param  {Storage}  driver\n                     * @return {String}\n                     */\n                    this._deriveDriver = function (driver) {\n                        return _keyByVal(this._registeredDrivers, driver);\n                    };\n\n                    /**\n                     * @type {Storage}\n                     */\n                    this._driver = this._resolveDriver(driver);\n\n                    /**\n                     * @type {String}\n                     */\n                    this._namespace = namespace;\n\n                    /**\n                     * @type {Boolean}\n                     */\n                    this._eventsEnabled = defaults.eventsEnabled;\n\n                    /**\n                     * @type {String}\n                     */\n                    this._separator = defaults.separator;\n\n                    /**\n                     * @type {Object}\n                     */\n                    this._watchers = {};\n\n                    /**\n                     * @type {String}\n                     */\n                    this._cryptoKey = { value : null };\n\n                    /**\n                     * Check browser support\n                     *\n                     * @see https://github.com/Modernizr/Modernizr/blob/master/feature-detects/storage/localstorage.js#L38-L47\n                     * @param  {String}  driver\n                     * @return {Boolean}\n                     */\n                    this._checkSupport = function (driver) {\n                        if (angular.isUndefined(this._supported)) {\n                            var l = 'l';\n                            try {\n                                this._resolveDriver(driver || 'local').setItem(l, l);\n                                this._resolveDriver(driver || 'local').removeItem(l);\n                                this._supported = true;\n                            } catch (e) {\n                                this._supported = false;\n                            }\n                        }\n\n                        return this._supported;\n                    };\n\n                    /**\n                     * Build the storage key from the namspace\n                     *\n                     * @param  {String}  key\n                     * @return {String}\n                     */\n                    this._getPrefix = function (key) {\n                        if (! this._namespace) return key;\n\n                        return this._namespace + this._separator + key;\n                    };\n\n                    /**\n                     * Try to encode value as json, or just return the value upon failure\n                     *\n                     * @param  {Mixed}  value\n                     * @return {Mixed}\n                     */\n                    this._serialize = function (value) {\n                        try {\n                            return angular.toJson(value);\n                        } catch (e) {\n                            return value;\n                        }\n                    };\n\n                    /**\n                     * Try to parse value as json, if it fails then it probably isn't json so just return it\n                     *\n                     * @param  {String}  value\n                     * @return {Object|String}\n                     */\n                    this._unserialize = function (value) {\n                        try {\n                            return angular.fromJson(value);\n                        } catch (e) {\n                            return value;\n                        }\n                    };\n\n                    /**\n                     * Trigger an event\n                     *\n                     * @param  {String} name\n                     * @param  {Object} payload\n                     * @return {void}\n                     */\n                    this._event = function (name, payload) {\n                        if (! this._eventsEnabled) return;\n\n                        $rootScope.$emit(name, angular.extend(payload, {\n                            driver: this._deriveDriver(this._driver),\n                            namespace: this._namespace\n                        }));\n                    };\n\n                    /**\n                     * Add to storage\n                     *\n                     * @param {String}  key\n                     * @param {Mixed}  value\n                     * @param {boolean}  encrypted\n                     */\n                    this._setItem = function (key, value, encrypted) {\n                        if (! this._checkSupport()) _error('The browser does not support localStorage');\n\n                        try {\n                            var oldVal = this._getItem(key);\n                            var serializedValue = this._serialize(value);\n                            var finalValue = serializedValue;\n\n                            if(!!encrypted && window.sjcl && !!this._cryptoKey.value && !!finalValue) {\n                                finalValue = window.sjcl.encrypt(this._cryptoKey.value, serializedValue, { mode: 'ccm', ks: 128 }, {});\n                            }\n\n                            this._driver.setItem(this._getPrefix(key), finalValue);\n                            if (this._exists(key) && ! angular.equals(oldVal, finalValue)) {\n                                this._event('locker.item.updated', { key: key, oldValue: oldVal, newValue: finalValue });\n                            } else {\n                                this._event('locker.item.added', { key: key, value: value });\n                            }\n                        } catch (e) {\n                            if (['QUOTA_EXCEEDED_ERR', 'NS_ERROR_DOM_QUOTA_REACHED', 'QuotaExceededError'].indexOf(e.name) !== -1) {\n                                _error('The browser storage quota has been exceeded');\n                            } else {\n                                _error('Could not add item with key \"' + key + '\"');\n                            }\n                        }\n                    };\n\n                    /**\n                     * Get from storage\n                     *\n                     * @param  {String}  key\n                     * @param  {boolean}  encrypted\n                     * @return {Mixed}\n                     */\n                    this._getItem = function (key, encrypted) {\n                        if (! this._checkSupport()) _error('The browser does not support localStorage');\n\n                        var finalValue = this._driver.getItem(this._getPrefix(key));\n                        var item = finalValue;\n\n                        if(!!encrypted && window.sjcl && !!this._cryptoKey.value && !!finalValue) {\n                            item = window.sjcl.decrypt(this._cryptoKey.value, finalValue, {}, {});\n                        }\n\n                        return this._unserialize(item);\n                    };\n\n                    /**\n                     * Exists in storage\n                     *\n                     * @param  {String}  key\n                     * @return {Boolean}\n                     */\n                    this._exists = function (key) {\n                        if (! this._checkSupport()) _error('The browser does not support localStorage');\n\n                        return this._driver.hasOwnProperty(this._getPrefix(_value(key)));\n                    };\n\n                    /**\n                     * Remove from storage\n                     *\n                     * @param  {String}  key\n                     * @return {Boolean}\n                     */\n                    this._removeItem = function (key) {\n                        if (! this._checkSupport()) _error('The browser does not support localStorage');\n\n                        if (! this._exists(key)) return false;\n                        this._driver.removeItem(this._getPrefix(key));\n\n                        this._event('locker.item.forgotten', { key: key });\n\n                        return true;\n                    };\n                }\n\n                /**\n                 * Define the public api\n                 *\n                 * @type {Object}\n                 */\n                Locker.prototype = {\n\n                    /**\n                     * Add a new item to storage (even if it already exists)\n                     *\n                     * @param  {Mixed}  key\n                     * @param  {Mixed}  value\n                     * @param  {Boolean}  encrypted\n                     * @return {self}\n                     */\n                    put: function (key, value, encrypted) {\n                        if (! key) return false;\n                        key = _value(key);\n\n                        if (angular.isObject(key)) {\n                            angular.forEach(key, function (value, key) {\n                                this._setItem(key, value, !!encrypted);\n                            }, this);\n                        } else {\n                            if (! angular.isDefined(value)) return false;\n                            this._setItem(key, _value(value, this._getItem(key, !!encrypted)), !!encrypted);\n                        }\n\n                        return this;\n                    },\n\n                    /**\n                     * Add an item to storage if it doesn't already exist\n                     *\n                     * @param  {Mixed}  key\n                     * @param  {Mixed}  value\n                     * @param  {Boolean}  encrypted \n                     * @return {Boolean}\n                     */\n                    add: function (key, value, encrypted) {\n                        if (! this.has(key)) {\n                            this.put(key, value, encrypted);\n                            return true;\n                        }\n\n                        return false;\n                    },\n\n                    /**\n                     * Retrieve the specified item from storage\n                     *\n                     * @param  {String|Array}  key\n                     * @param  {Mixed}  def\n                     * @param  {Boolean}  encrypted\n                     * @return {Mixed}\n                     */\n                    get: function (key, def, encrypted) {\n                        if (angular.isArray(key)) {\n                            var items = {};\n                            angular.forEach(key, function (k) {\n                                if (this.has(k)) items[k] = this._getItem(k, !!encrypted);\n                            }, this);\n\n                            return items;\n                        }\n\n                        if (! this.has(key)) return [2,3].indexOf(arguments.length) !==  -1? def : void 0;\n\n                        return this._getItem(key, !!encrypted);\n                    },\n\n                    /**\n                     * Determine whether the item exists in storage\n                     *\n                     * @param  {String|Function}  key\n                     * @return {Boolean}\n                     */\n                    has: function (key) {\n                        return this._exists(key);\n                    },\n\n                    /**\n                     * Remove specified item(s) from storage\n                     *\n                     * @param  {Mixed}  key\n                     * @return {Object}\n                     */\n                    forget: function (key) {\n                        key = _value(key);\n\n                        if (angular.isArray(key)) {\n                            key.map(this._removeItem, this);\n                        } else {\n                            this._removeItem(key);\n                        }\n\n                        return this;\n                    },\n\n                    /**\n                     * Retrieve the specified item from storage and then remove it\n                     *\n                     * @param  {String|Array}  key\n                     * @param  {Mixed}  def\n                     * @param  {Boolean}  encrypted\n                     * @return {Mixed}\n                     */\n                    pull: function (key, def, encrypted) {\n                        var value = this.get(key, def, !!encrypted);\n                        this.forget(key);\n\n                        return value;\n                    },\n\n                    /**\n                     * Return all items in storage within the current namespace\n                     *\n                     * @return {Object}\n                     */\n                    all: function () {\n                        var items = {};\n                        angular.forEach(this._driver, function (value, key) {\n                            var split = key.split(this._separator);\n                            if (split.length > 1 && split[0] === this._namespace) {\n                                split.splice(0, 1);\n                                key = split.join(this._separator);\n                            }\n                            if (this.has(key)) items[key] = this.get(key);\n                        }, this);\n\n                        return items;\n                    },\n\n                    /**\n                     * Remove all items set within the current namespace\n                     *\n                     * @return {self}\n                     */\n                    clean: function () {\n                        this.forget(Object.keys(this.all()));\n\n                        return this;\n                    },\n\n                    /**\n                     * Empty the current storage driver completely. careful now.\n                     *\n                     * @return {self}\n                     */\n                    empty: function () {\n                        this._driver.clear();\n\n                        return this;\n                    },\n\n                    /**\n                     * Get the total number of items within the current namespace\n                     *\n                     * @return {Integer}\n                     */\n                    count: function () {\n                        return Object.keys(this.all()).length;\n                    },\n\n                    /**\n                     * Bind a storage key to a $scope property\n                     *\n                     * @param  {Object}  $scope\n                     * @param  {String}  key\n                     * @param  {Mixed}   def\n                     * @param  {String}  attr\n                     * @return {self}\n                     */\n                    bind: function ($scope, key, def, attr) {\n                        var index = attr || key;\n\n                        var self = this;\n                        var watcherId = (index + $scope.$id);\n\n                        this._watchers[ watcherId] = $scope.$watch(index, function (newVal) {\n                            if (angular.isDefined(newVal)) {\n                                self.put(key, newVal);\n                            }\n                        }, angular.isObject($scope[index]));\n\n                        if (angular.isUndefined( $scope.$eval(index) )) {\n                            var value = this.get(key, def);\n                            $parse(index).assign($scope, value);\n                        }\n\n                        return this;\n                    },\n\n                    /**\n                     * Bind a storage key to a $scope property, and encrypt it\n                     *\n                     * @param  {Object}  $scope\n                     * @param  {String}  key\n                     * @param  {Mixed}   def\n                     * @param  {String}  attr\n                     * @return {self}\n                     */\n                    bindEncrypted: function ($scope, key, def, attr) {\n                        var index = attr || key;\n\n                        var self = this;\n                        var watcherId = (index + $scope.$id);\n\n                        this._watchers[ watcherId] = $scope.$watch(index, function (newVal) {\n                            if (angular.isDefined(newVal)) {\n                                self.put(key, newVal, true);\n                            }\n                        }, angular.isObject($scope[index]));\n\n                        if (angular.isUndefined( $scope.$eval(index) )) {\n                            var value = this.get(key, def, true);\n                            $parse(index).assign($scope, value);\n                        }\n\n                        return this;\n                    },\n\n                    /**\n                     * Unbind a storage key from a $scope property\n                     *\n                     * @param  {Object}  $scope\n                     * @param  {String}  key\n                     * @param  {String}  attr\n                     * @param  {boolean}  dontForget\n                     * @return {self}\n                     */\n                    unbind: function ($scope, key, attr, dontForget) {\n                        var index = attr || key;\n\n                        $parse(index).assign($scope, null);\n\n                        if(!dontForget) {\n                            this.forget(key);\n                        }\n\n                        var watcherId = (index + $scope.$id);\n                        if (this._watchers[watcherId]) {\n                            this._watchers[watcherId]();\n                            delete this._watchers[watcherId];\n                        }\n\n                        return this;\n                    },\n\n                    /**\n                     * Set the storage driver on a new instance to enable overriding defaults\n                     *\n                     * @param  {String}  driver\n                     * @return {self}\n                     */\n                    driver: function (driver) {\n                        return this.instance(driver, this._namespace);\n                    },\n\n                    /**\n                     * Get the currently set driver\n                     *\n                     * @return {Storage}\n                     */\n                    getDriver: function () {\n                        return this._driver;\n                    },\n\n                    /**\n                     * Set the namespace on a new instance to enable overriding defaults\n                     *\n                     * @param  {String}  namespace\n                     * @return {self}\n                     */\n                    namespace: function (namespace) {\n                        return this.instance(this._deriveDriver(this._driver), namespace);\n                    },\n\n                    /**\n                     * Get the currently set namespace\n                     *\n                     * @return {String}\n                     */\n                    getNamespace: function () {\n                        return this._namespace;\n                    },\n\n                    /**\n                     * Check browser support\n                     *\n                     * @see https://github.com/Modernizr/Modernizr/blob/master/feature-detects/storage/localstorage.js#L38-L47\n                     * @param  {String}  driver\n                     * @return {Boolean}\n                     */\n                    supported: function (driver) {\n                        return this._checkSupport(driver);\n                    },\n\n                    /**\n                     *\n                     * @param {String} key\n                     */\n                    setCryptoKey: function(key){\n                        if (!angular.isString(key) || key.length === 0 || key.replace(/\\s/gm, '').length === 0) { // Check non-blank\n                            return;\n                        }\n\n                        this._cryptoKey.value = key;\n                    },\n\n                    /**\n                     * Get a new instance of Locker\n                     *\n                     * @param  {String}  driver\n                     * @param  {String}  namespace\n                     * @return {Locker}\n                     */\n                    instance: function (driver, namespace) {\n                        var locker = new Locker(driver, namespace);\n                        locker.setCryptoKey(this._cryptoKey.value);\n                        return  locker;\n                    }\n                };\n\n                // return the default instance\n                return new Locker(defaults.driver, defaults.namespace);\n            }]\n        };\n\n    });\n\n});\n"],"sourceRoot":"/source/"}